---
layout: post
title: "STM32(自学)-学习烧录(二)"
categories: STM32
tags: STM32
author: fengsh998
typora-root-url: ..
---

## 前言：
硬件：SIM32F103C8T6-最小开发版

通过点亮板载LED的灯进行学习烧录程序。

开始之前将PC13脚设置为GPIO-OUTPUT的方式,设置模式为推挽输出，默认为高电平，并使用上拉电阻配置初始态为高电平。

![img](/assets/articles/ic/stm32/link/led0.jpg)

### SWD 烧录-通过(STLink的方式-支持Debug)

> 一定要买正规的原装开发板和STLinkV2/V3,否则DEBUG时各种毛病。
> 
> 盗版和克隆版的不稳定，且不支持DEBUG，只能(.hex)进行烧写操作。
{: .prompt-danger }

完成代码编写：

```c
...
/* USER CODE BEGIN WHILE */
  while (1)
  {
	  /// 1长三短闪动
	  ///设置低电平点亮(因为PC13脚接的是LED的负极)
	  HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_RESET);
	  /*mac option + / 代码提示*/
	  HAL_Delay(2000);
	  HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_SET);
	  HAL_Delay(200);
	  HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_RESET);
	  HAL_Delay(200);
	  HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_SET);
	  HAL_Delay(200);
	  HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_RESET);
	  HAL_Delay(200);
	  HAL_GPIO_WritePin(LED0_GPIO_Port, LED0_Pin, GPIO_PIN_SET);
	  HAL_Delay(200);
    /* USER CODE END WHILE */

    /* USER CODE BEGIN 3 */
  }
...
```

电脑必须连接上开发版。

硬件连接图：

![img](/assets/articles/ic/stm32/link/linkstv2.jpg)

        ST-Link                STM32F103C8T6
        ┌────────┐            ┌────────────┐
        │ SWDIO  ├───► PA13   │ Pin 34     │
        │ SWCLK  ├───► PA14   │ Pin 37     │
        │ GND    ├───► GND    │ Pin 8      │
        │ 3.3V   ├───► 3.3V   │ Pin 9      │
        └────────┘            └────────────┘


![img](/assets/articles/ic/stm32/link/debug.jpg)
如果烧录时报下面错：则安装[STLink-Server](https://www.st.com/en/development-tools/st-link-server.html)
![img](/assets/articles/ic/stm32/link/stlink-err.jpg)
还有如果用的STLinkV2/V3版，可能提示STLink更新。

在出现更新页面时如果点击Open in update mode,报ST-Link is not in the DFU mode. Please restart it.

则需要把STLink 从USB上断开，然后检测STM32F103C8T6的开发板上的BOOT0是否短接，如果是则不用操作，直接按着Reset键不松手，插上USB，再松开Reset.然后点击Refresh device list 再来点Open in update mode ,此时就可以正确的刷新到设备信息了。就可以进行Upgrade操作了。
![img](/assets/articles/ic/stm32/link/stv2update.jpg)

![img](/assets/articles/ic/stm32/link/stlinkv2err.jpg)
如果使用STLinkV2连接时报下面错：网上搜索产生原因可能是因为国产芯片的问题。

```Shell
STMicroelectronics ST-LINK GDB server. Version 7.11.0
Copyright (c) 2025, STMicroelectronics. All rights reserved.

Starting server with the following options:
        Persistent Mode            : Disabled
        Logging Level              : 1
        Listen Port Number         : 61234
        Status Refresh Delay       : 15s
        Verbose Mode               : Disabled
        SWD Debug                  : Enabled
        InitWhile                  : Enabled


Error in initializing ST-LINK device.
Reason: ST-LINK: Could not verify ST device! Abort connection.
```

这个时侯需要使用STM32CubeProgrammer来安装，但在安装之前需将程序编译为.hex才能装.elf的不能装 <font color="red">心痛啊，估计是买到克隆版了，没有买到原装芯片板</font>

![img](/assets/articles/ic/stm32/link/real.jpg)

工程 -> 右键属性 -> C/C++ Build -> Settings -> MCU/MPU Post build outputs 然后把 Convert to binanry file 和 Convert to Intel Hex file勾上。
![img](/assets/articles/ic/stm32/link/hex.jpg)
![img](/assets/articles/ic/stm32/link/program.jpg)
![img](/assets/articles/ic/stm32/link/download.jpg)
注意选择的是.hex文件来烧录。下载完成后，点复位键即可运行新的程序。

>虽说这样能下载了，但不能断点调试，也是一个烦心事。
{: .prompt-danger }

于是重新下单买了个原装芯片板回来试下。


## USART串口烧录：

硬件：一块USB转TTL的板子。

![img](/assets/articles/ic/stm32/link/usart.jpg)

USART(基于ISP协议) 串口烧录：

> 注意的是串口并不是TX连接TX，TR连接TR，而是TX 和TR相连，实现一收一发。
{: .prompt-tips }

接线：注意设置跳线如下，3.3V 可以不接，如果板载USB上电的情况下，可以不接TTL的3.3V，如果开发板不加电时再接。

        [你的板子]                 [电脑]
        STM32F103C8T6    USB-TTL     PC
        ┌────────────┐   ┌──────┐   ┌────────┐
        │ 3.3V       ├──►│ 3.3V ├───│        │
        │ PA9  (TX)  ├──►│ RX   ├───│ COMx   │
        │ PA10 (RX)  ├──►│ TX   ├───│        │
        │ GND        ├──►│ GND  ├───│        │
        └────────────┘   └──────┘   └────────┘

        1. BOOT0=1, BOOT1=0
        2. 上电 → 运行 ST 出厂的 ISP Bootloader
        3. 电脑发送命令 → 芯片应答 → 下载 .hex
        4. 烧完 → BOOT0=0 → 运行程序

![img](/assets/articles/ic/stm32/link/ttl.jpg)

步聚：
1、将USB2TTL和开发板对应的脚接线。
2、设启动跳线：BOOT0=1, BOOT1=0 。

![img](/assets/articles/ic/stm32/link/ttl2.jpg)

3、插上USB2TTL模块。
4、打开CubeProgammer 选择 UART，在下拉的Port那里选中你的USB2TTL的端口，然后点击connect.

![img](/assets/articles/ic/stm32/link/pg1.jpg)
![img](/assets/articles/ic/stm32/link/pg2.jpg)

5、选择Erasing & programming,然后选择.hex进行烧录。
6、烧录完成后，把跳线跳回来原来的位置，重新上电。此时新烧录的程序可正常运行。