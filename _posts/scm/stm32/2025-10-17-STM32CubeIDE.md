---
layout: post
title: "STM32(自学)-CubeIDE的可视化配置了解(一)"
categories: STM32
tags: STM32
author: fengsh998
typora-root-url: ..
---

## 环境说明
**操作系统:** MacOS Tahoe 26

**STM32CubeIDE version**: 1.19.0

文章以**STM32F103C8T6**为例说明

## 创建项目
1、第一次启动IDE，将提示设置项目工作域，即以后的工程存放的地方。
![img](/assets/articles/ic/stm32/ide/stmlaunch.jpg)

2、在主页(Start new STM32 project)或菜单中选择"file"->"new"->"STM32 Project"。
![img](/assets/articles/ic/stm32/ide/idehome.jpg)

3、MCU/MPU 芯片选择页,输入自己项目用到的芯片。然后点击选中的芯片，此时可以在上面的菜单中下载对应的Datasheet之类的或到供应商采购都有相应的快速连接。服务还挺周到的。再后next
![img](/assets/articles/ic/stm32/ide/idefilter.jpg)

4、填写项目名，如果是C或C++，看自己的熟悉度来选，最后编译结果，正常写刷机程序一般都是可执行嘛，如果只是开发成一个库，提供给别人使用，不能独立运行的，则可编译成静态库。
![img](/assets/articles/ic/stm32/ide/idepj.jpg)

5、finish, 在弹出是否使用可视化配置及相关的设备驱动，选yes，则可生成一个项目基础目录框架。如果选no，则项目只生成一个.ioc文件。
![img](/assets/articles/ic/stm32/ide/finish.jpg)


## 根据项目需求，配置Pin脚功能
![img](/assets/articles/ic/stm32/ide/pinconfig.jpg)
> 在配置芯片的Pin脚时，一定是根据项目的需求要求实现某一能力，才来选的，并不是瞎设置。
> 
> 其次在System Core(系统核心功能), Analog(模拟转数字区), Timers(定时和时钟配置), Connectivty(外设通信), Computing(计算较验), Middleware and Software Packs(中间件和软件包)
{: prompt-tips }

### System Core配置项说明

|功能|配置说明|
|---|---|
|**DMA(直接内存访问)**|可配置外设访问内存或内存访问外设|
|**GPIO(通用IO)**|对所有选中指定作为GPIO功能的脚进行配置|
|**IWDG(独立看门狗)**|独立看门狗的相关配置|
|**NVIC(中断控制)**|中断配置，默认开启了系统内核的中段(不能改配)，只有外部中断可以配置|
|**RCC(复位和时钟控制)**|复位和时钟配置|
|**SYS(系统模式)**|系统模式配置|
|**WWDG(窗口看门狗)**|窗口看门狗相关配置|

### Analog 模拟转数字配置

|功能|配置说明|
|---|---|
|**ADC1**|模拟转数字组1|
|**ADC2**|模拟转数字组2|

### Timers 时钟和定时配置

芯片不同定时组数也不同

|功能|配置说明|
|---|---|
|**RTC(实时时钟)**|时钟配置|
|**TIM1(定时器组1)**|定时组1配置|
|**TIM2(定时器组2)**|定时组2配置|
|**TIM3(定时器组3)**|定时组3配置|
|**TIM4(定时器组4)**|定时组4配置|

### Connectivity 外设配置

不同的芯片支持的外设也不相同

|功能|配置说明|
|---|---|
|**CAN**|CAN接口|
|$$ I^2C1 $$|I方C通讯组1|
|$$ I^2C1 $$|I方C通讯组2|
|**SPI1**|SPI组1|
|**SPI2**|SPI组2|
|**USART1**|串口通讯组1|
|**USART2**|串口通讯组2|
|**USART3**|串口通讯组3|
|**USB**|USB通讯|

### Pin脚功能定义(不同芯片复用的功能不同):

>详细需要查阅最新的芯片对应的Datasheet文档
{: .prompt-info }

**每个Pin脚复用的功能怎么用，需要根据文档说明书来使用。**

常见的Pin脚功能说明：

|CubeIDE 显示|I/O类型|是否需要外部晶振|是否支持中断|典型用途|说明|
|----|---|---|---|---|---|
|RTC_OUT|输出|是（LSE）|否|1Hz 方波输出|输出信号（可配置为报警、校准、唤醒等）|
|RTC_TAMPER|输入|否|是|防拆检测|防篡改输入（带时间戳）|
|RCC_OSC32_IN/OUT|晶振|是（32.768kHz）|否|RTC 时钟源|用来走时或定时|
|RCC_OSC_IN/OUT|晶振|是（HSE）|否|系统主时钟|CPU执行指令|
|GPIO_Input|输入|否|可配 EXTI|按键、传感器|数字输入模式<br>可配置上拉/下拉/浮空|
|GPIO_Output|输出|否|否|LED、继电器|数字输出模式<br>推挽/开漏，速度可选（2/10/50 MHz）|
|GPIO_Analog|模拟|否|否|ADC 输入、低功耗|模拟模式（高阻）<br>禁用数字缓冲，用于 ADC/DAC 或低功耗|
|EVENTOUT|事件输出|否|否|调试信号|可输出内部事件（如 DMA 完成）到外部引脚|
|GPIO_EXTI(x)|输入|否|是|按键中断|-外部中断<br>-通过触发上升/下降沿方式引发中断<br>-x为对应的Pin编号,如PC15，则x=15,注不是管脚的序号|
|ADC(x)_EXTI(y)|输入|否|是|触发式采样|ADC + 中断<br>模拟输入 + 可触发中断|
|ADC(x)_IN|模拟信号输入|否|否|电压测量|纯模拟采样，无中断<br>纯 ADC|
|TIM(x)_CH(y)<br>如TIM2_CH1|I/O|否|是|PWM 输出 / 输入捕获 / 编码器|可触发中断<br>定时器通道|
|TIM(x)_ETR|输入|否|是|外部时钟计数|外部触发|
|SYS_WKUP（系统唤醒）|输入|否|否|Standby 模式唤醒引脚|从 Standby 唤醒 MCU|
|USART(x)_CTS|输入|否|否|硬件流控：接收方通知“可以发”|串口通讯<br>全称Clear To Send|
|USART(x)_RTS|输出|否|否|硬件流控：发送方请求“允许发”|串口通讯<br>全称Request To Send|
|USART(x)_TX|输出|否|否|发送数据（推挽）|串口通讯<br>全称Transmit Data|
|USART(x)_RX|输入|否|否|接收数据|串口通讯<br>全称Receive Data|
|USART(x)_CK|输出|否|否|同步模式时钟输出（罕用）|串口通讯<br>全称Clock Output|
|SPI(x)_NSS|主：输出<br>从：输入|-|-|输出：MCU 拉低选中从设备<br>输入：外部主设备拉低时开始通信|片选信号（Slave Select）<br>可通过 HAL_SPI_Transmit 手动控制|
|SPI(x)_SCK|主：输出<br>从：输入|-|-|输出：MCU 生成时钟（最高 36 MHz @ 72MHz）<br>输入：外部提供时钟|时钟信号(Serial Clock)<br>|
|SPI(x)_MISO|主：输入<br>从：输出|-|-|输入：接收从设备数据<br>输出：发送数据给主设备|主进从出(Master In Slave Out)|
|SPI(x)_MOSI|主：输出<br>从：输入|-|-|输出：发送数据到从设备<br>输入：接收主设备数据|主出从进(Master Out Slave In)|
|I2C(x)_SDA|开漏 I/O|-|-|传输地址、数据、ACK/NACK|数据线全称Serial Data Line<br>双向开漏（Bidirectional Open-Drain）<br>0 = 拉低，1 = 释放（靠外部上拉电阻到 3.3V）<br>必须外接 2.2k ~ 4.7k（推荐 3.3k）上拉电阻|
|I2C(x)_SCL|开漏 I/O|-|-|传输时钟控制|时钟线全称Serial Clock Line<br>开漏输出（主机生成时钟）<br>标准模式 100 kHz，快模式 400 kHz<br>从设备可拉低 SCL 暂停通信|
|I2C(x)_SMBA|开漏输出|-|-|SMBus 协议中用于主机轮询从设备状态|SMBus 警报（极少用）全称System Management Bus Alert<br>开漏输出（从设备拉低报警）<br>可忽略，99% 项目不用|
|USB_DM|差分输入/输出|-|-|USB 设备模式（Udisk、HID、CDC 等）|USB 数据负极(USB Data Minus)|
|USB_DP|差分输入/输出|-|-|USB 枚举、数据传输|USB 数据正极(USB Data Plus)|
|CAN_RX|输入|-|-|CAN 接收|-|
|CAN_TX|输出|-|-|CAN 发送|-|


USART 配置：

    1. Pinout & Configuration
    └─ Connectivity
      └─ USART2
         ├─ Mode: Asynchronous
         ├─ Baud Rate: 115200
         ├─ Hardware Flow Control: CTS + RTS
         └─ Parameter Settings: 8N1
    2. 自动分配引脚：
        PA0 → USART2_CTS
        PA1 → USART2_RTS
        PA2 → USART2_TX
        PA3 → USART2_RX
        PA4 → USART2_CK（仅同步模式）

USART硬件连接图（标准 RS232 流控）

     STM32F103               外设（如 PC/模块）
     PA2 (TX)  ──────▶ RX
     PA3 (RX)  ◀─────── TX
     PA0 (CTS) ◀─────── RTS（对端）
     PA1 (RTS) ──────▶ CTS（对端）
     GND       ──────▶ GND


SPI 配置：

    1. Pinout & Configuration
     └─ Connectivity
      └─ SPI1
         ├─ Mode: Full-Duplex Master
         ├─ Hardware NSS Signal: Enable (Output)
         ├─ Data Size: 8 Bits
         ├─ First Bit: MSB First
         ├─ Clock Polarity (CPOL): Low
         ├─ Clock Phase (CPHA): 1 Edge
         ├─ Baud Rate Prescaler: 8 (9 MHz @ 72MHz)
         └─ NSS Signal Type: Hardware
         
    2. 自动分配引脚：
        PA4 → SPI1_NSS
        PA5 → SPI1_SCK
        PA6 → SPI1_MISO
        PA7 → SPI1_MOSI
   

SPI 硬件接线：

    STM32F103 (Master)        从设备（如 TFT、SD卡、NRF24）
    PA4 (NSS)  ──────▶ CS
    PA5 (SCK)  ──────▶ SCK/SCL
    PA6 (MISO) ◀────── DOUT/MISO
    PA7 (MOSI) ──────▶ DIN/MOSI
    GND        ──────▶ GND
    VCC        ──────▶ VCC (3.3V)




如：PB6 完整复用功能表（STM32F103C8T6）

![img](/assets/articles/ic/stm32/ide/pb6.jpg)

|CubeIDE 显示（Mode）|外设功能|I/O 类型|主要用途|官方备注|
|---|---|---|---|---|
|GPIO_Input|GPIO 输入|输入|数字输入（浮空/上拉/下拉）|可配 EXTI6
|GPIO_Output|GPIO 输出|输出|推挽/开漏输出（2/10/50 MHz）|—|
|GPIO_Analog|GPIO 模拟|模拟|ADC 输入 / 低功耗模式|禁用数字缓冲|
|I2C1_SCL|I²C1 时钟线|开漏输出|I²C 主机/从机 SCL|需外接上拉电阻|
|TIM4_CH1|定时器 4 通道 1|I/O|PWM 输出 / 输入捕获 / 编码器|可触发中断|
|USART1_TX|USART1 发送|输出|串口发送数据（推挽）|常用串口调试|
|EVENTOUT|Cortex 事件输出|输出|输出内部事件信号（如 DMA 完成）|调试用途|
|GPIO_EXTI6|外部中断线 6|输入|上升/下降沿中断|可配 NVIC|

## 时钟配置
选择"System Core"中的RCC,如果版子上配置了外部晶振，则可以配置外部时钟

High Speed Clock(HSE): 主时钟，CPU执行指,常见8MHz

Low Speed Clock(LSE): 走时，定时，常用32.768kHz

可选择：
* Disable
* BYPASS Clock Source(旁路时钟源)，外部已经提供方波时钟（有源晶振、函数发生器、另一颗 MCU 输出）→ 芯片不驱动，只把外部信号直接当 HSE 输入
* Crystal/Ceramic Resonator(晶体/陶瓷谐振器) ，芯片自己驱动外部晶振起振（需要两个负载电容）

因STM32F103C8T6的板子上只有一个8MHz和一个32.768KHz的无源晶振(只有2个引脚)，有源和无源的区别是，无源只有两脚靠电容产生驱动，而有源4脚即有电源(+-)脚供电。
故在配置外部时钟时选择Crystal/Ceramic Resonator。只有当芯片内部集成有时间钟时，可以选择Disable.

![img](/assets/articles/ic/stm32/ide/rcc.jpg)

![img](/assets/articles/ic/stm32/ide/clock-cfg.jpg)

**HSI(High Speed Internal)**: 芯片 内部 RC 振荡器,不需要额外的外电路硬件。

**HSE(High Speed External)**:芯片 外部 晶振（焊在板子上）,常见需要（8 MHz 晶振 + 2 个电容）。

**PLL(Phase Locked Loop)**:锁循环。

**PLL Source Mux（PLL 输入源选择）**: 主频，如HSE 分频为1，则频率为8M,如HSI 分频为2，则主频只有 8 / 2 = 4M

**PLLMul(倍频系数)**: 决定 SYSCLK 频率

**PLLCLK（PLL 输出时钟）**: 公式：PLLCLK = PLL Source × PLLMul

**RTC Clock Mux（RTC 时钟源选择）**:主要是决定时间怎么走。

**LSI（Low Speed Internal）**:芯片内部 40 kHz RC 振荡器,备用 RTC 或 看门狗（IWDG）

**LSE（Low Speed External）**:板上 32.768 kHz 无源晶振,给 RTC 提供 高精度时钟

**System Clock Mux（系统时钟源选择）**: 决定整个系统跑多快

![img](/assets/articles/ic/stm32/ide/hse.jpg)

![img](/assets/articles/ic/stm32/ide/sysconfig.jpg)

## 工程管理设置，通常只需要设置一次即可

![img](/assets/articles/ic/stm32/ide/pjcfg.jpg)

最后在上面的可视化配置完之后进行save动作时，会提示是否自动生成代码。选择YES。

![img](/assets/articles/ic/stm32/ide/last.jpg)

参考：

[【CubeIDE帮助文档(English)】](https://www.st.com/resource/en/user_manual/um2609-stm32cubeide-user-guide-stmicroelectronics.pdf)