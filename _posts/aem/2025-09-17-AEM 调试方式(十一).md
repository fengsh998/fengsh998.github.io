---
layout: post
title: "AEM开发系列【后端】- 调试方式(十一)"
categories: AEM开发系列
tags: AEM
author: fengsh998
typora-root-url: ..
---

# 如何调试接口？

文章基于上一章节的示例进行说明调试方式

## 1、通过打印日志的方式进行调试。

打印日志的方式进行调试。

打开控制台：http://localhost:4502/system/console，sling中找到Log Support或直接：http://localhost:4502/system/console/slinglog

![img](/assets/articles/aem/debug/debug-1.jpg)

打开日志控制台后，进行Add new Logger

![img](/assets/articles/aem/debug/debug-2.jpg)

然后在浏览器或AEM中访问接口，产生日志文件，刷新http://localhost:4502/system/console/slinglog，在Appender中找到你的日志文件，右键新窗口打开，或直接点击。

![img](/assets/articles/aem/debug/debug-3.jpg)

打开日志访问路径查看：

![img](/assets/articles/aem/debug/debug-4.jpg)

日志如何清除？
到本地AEM-SDK的目录下找到crx-quickstart 中logs里删除即可

## 2、通过远程连接可断点调试。

由于启动本地AEM SDK时使用的远程地址：

java -Xms2048M -Xmx2048M -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8765 -jar aem-sdk-p4502.jar -p 4502 -v -r author,local

### IDEA 调试
在Run/Debug Configurations 中添加一个Remote JVM Debug,然后在 Command line arguments for remote JVM:这里把address的端口修改为启动AEM的本地SDK时的端口。

不同的JDK启动远程调试的语句不同，从IDEA中复制即可。如：
```shell
#Java8
#java -Xms2048M -Xmx2048M -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8765 -jar aem-sdk-p4502.jar -p 4502 -v -r author,local

#java17之后 不再使用-Xdebug
java -Xms2048M -Xmx2048M -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8765 -jar aem-sdk-p4502.jar -p 4502 -v -r author,local
```

> 是否可以能进行远程断点调试，决定于
> 
> 1、启动AEM SDK时是否开启了远程调试端口。
> 
> 2、IDEA中是否配置了和启动AEM SDK时对应的端口启动命令行。
{: .prompt-tip }

设置完后，就可以能过IDEA的DEBUG来进行断点调试了。

![img](/assets/articles/aem/debug/debug-6.jpg)

![img](/assets/articles/aem/debug/debug-7.jpg)

### VSCode调试
准备：
vscode 安装插件：
1. Extension Pack for Java 
2. Debugger for Java

__配置VSCODE项目__

在项目中的根目录下如：.vscode下新建一个launch.json文件。
```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "java",
      "name": "Debug (Attach) - Remote",
      "request": "attach",
      "hostName": "localhost",
      "port": 8000
    }
  ]
}
```
这里的port 指定的是AEM SDK启动时使用的端口。默认8000，可自行指定如8765

![img](/assets/articles/aem/debug/debug-8.jpg)

设置完之后，通过VS的运行调试启动项目，然后在需要的地方设置断点，就可以了。

![img](/assets/articles/aem/debug/debug-9.jpg)
