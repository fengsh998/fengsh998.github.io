---
layout: post
title: "AEM开发系列-本地开发环境搭建(一)"
categories: AEM开发系列
tags: AEM
author: fengsh998
typora-root-url: ..
---

# AEM(adobe experience Manager) 本地开发环境搭建

环境说明：
操作系统: MacOS Tahoe 26
JDK11以上
AEM SDK：
开发使用的IDE可选IDEA或VSCODE。

### 一、安装JDK11或17
[JDK下载地址](https://www.oracle.com/java/technologies/downloads/?er=221886)
下载安装好之后打开终端执行java -version查看JDK的版本

如果有多个JDK版本安装的，需要配置环境变量进行切换
先查看本地是否安装过JDK，
`
/usr/libexec/java_home -V
`
环境变量(macos)设置通常在~/.bash_profile或~/.zshrc下面（新旧系统要求不同），可以通过使用echo $SHELL 来查看你的电脑的环境变量使用的是那个。如：
* /bin/zsh 说明你用的是 Zsh，建议放到 ~/.zshrc
* /bin/bash 说明用的是 Bash，可放 .bash_profile

修改好之后，source ~/.zshrc或重起终端即可使环境变量生效。

{% highlight shell %}
...
# JAVA SDK
export JAVA_8_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0_261.jdk/Contents/Home
export JAVA_11_HOME=/Library/Java/JavaVirtualMachines/jdk-11.jdk/Contents/Home
export JAVA_17_HOME=/Library/Java/JavaVirtualMachines/jdk-17.jdk/Contents/Home
export JAVA_21_HOME=/Library/Java/JavaVirtualMachines/jdk-21.jdk/Contents/Home

function java8() {
  export JAVA_HOME=$JAVA_8_HOME
  export PATH="$JAVA_HOME/bin:$PATH"
  hash -r
  echo "Switched to JDK 8"
  echo "JAVA_HOME: $JAVA_HOME"
  echo "Java version:"
  java -version
}

function java11() {
  export JAVA_HOME=$JAVA_11_HOME
  export PATH="$JAVA_HOME/bin:$PATH"
  hash -r
  echo "Switched to JDK 11"
  echo "JAVA_HOME: $JAVA_HOME"
  echo "Java version:"
  java -version
}

function java17() {
  export JAVA_HOME=$JAVA_17_HOME
  export PATH="$JAVA_HOME/bin:$PATH"
  hash -r
  echo "Switched to JDK 17"
  echo "JAVA_HOME: $JAVA_HOME"
  echo "Java version:"
  java -version
}

function java21() {
  export JAVA_HOME=$JAVA_21_HOME
  export PATH="$JAVA_HOME/bin:$PATH"
  hash -r
  echo "Switched to JDK 21"
  echo "JAVA_HOME: $JAVA_HOME"
  echo "Java version:"
  java -version
}
...
{% endhighlight %}

只需要在终端执行java8或java11或java17或java21即可实现JDK的切换

### 二、下载AEM 的本地开SDK(需要有梯子哈)
1、必须注册Adobe Experience Cloud账号。
2、[AEM SDK下载地址](https://experience.adobe.com/#/downloads/content/software-distribution/en/aemcloud.html)
![img](/assets/articles/aem/本地环境/aem-sdk-downloads.jpg)
3、解压到目地目录即可(如/downloads/aemsdk)，解压后是一个.jar包
4、cd /downloads/aemsdk下，分别新建文件夹author,publish,dispather
5、把第3步解压的.jar包，分别copy到author和publish下，重新命名(不是必须的，目的是为了自己更加清晰而已)，
如：<font color="red">author/aemsdk-p4502.jar,publish/aemsdk-p4503.jar</font>.
::: tip
因为adobe通常建议author角色时启动的服务是4502端口，而本地的publish使用的是4503.
:::
6、编写启动服务脚本，通常本地开发只需要启动author的服务就够用了，publish只有在配合dipsather进行测试的时候才需要使用。
::: info
最简单便捷就是直接java -jar your-aem-sdk.jar -gui
:::

本地author服务脚本start.sh,运行端口是4502，且aem开启远程调试端口8765
{% highlight shell %}
#!/bin/bash
source ~/.zshrc
java17
#Java 9之前的写法
#java -Xms2048M -Xmx2048M -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8765 -jar aem-sdk-p4502.jar -p 4502 -v -r author,local
#Java 11及以后
java -Xms2048M -Xmx2048M -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address=8765 -jar aem-sdk-p4502.jar -p 4502 -v -r author,local
{% endhighlight %}

本地publish服务：start.sh，运行的端口为4503,且aem开启远程调试端口8766
{% highlight shell %}
#!/bin/bash
source ~/.zshrc
java17
java -Xms2048M -Xmx2048M -Xdebug -Xrunjdwp:transport=dt_socket,server=y,suspend=n,address=8766 -jar aem-sdk-p4503.jar -p 4503 -v -r publish,local
{% endhighlight %}

> [!CAUTION]
> 第一次启动时会提示输入admin的密码，本地开发调试，通常账号和密码都是admin
![img](/assets/articles/aem/本地环境/start-author-pwd.png)
同时也可以查看工程代码中Pom中使用的sling对应配置的用户和密码，在下一节中介绍如何创建代码工程项目。
![img](/assets/articles/aem/本地环境/start-dev-code-pom.png)
启动成功后会自动打开浏览器，http://localhost:4502/,如图：
![img](/assets/articles/aem/本地环境/start-success.png)
登陆界面
![img](/assets/articles/aem/本地环境/start-webcome.png)
author站点设计界面
![img](/assets/articles/aem/本地环境/start-manager.png)

7、停止服务：在已启动的命令行窗口执行Ctrl+C 或 control+c
::: warning
这个停止时间有点长，如果没有停止结点就关闭了窗口，下次启动时可能会报端口已经占用了。如果是mac os只需要lsof -i:4502 找到pid进行kill -9 pid即可停止进程。
:::




可以参考官方文档：
[Local Development](https://experienceleague.adobe.com/en/docs/experience-manager-learn/cloud-service/local-development-environment-set-up/aem-runtime)


