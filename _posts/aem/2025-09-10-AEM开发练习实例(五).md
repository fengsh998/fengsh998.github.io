---
layout: post
title: "AEM开发系列-开发练习实例(五)"
categories: AEM开发系列
tags: AEM
author: fengsh998
typora-root-url: ..
---

# 示例
## 练习一：创建一个HTL的AEM组件
***步聚：***
1、打开CXRDE lite, 找到/apps/wetrain/components。
2、在components右键创建结点。
3、输入结点名quote, 结点类型选择为:cq:Component。
4、点击save all进行保存。
5、选中quote结点，添加以下属性，然后点击save all进行保存。

| 属性名 | 类型 | 值 | 说明 |
|-------|-----|----|------|
| jcr:title | String | Quote | 设置用于组件显示的标题名称。|
| componentGroup | String | wetrain - Content | 设置用于组件显示时的分组名称。|

![img](/assets/articles/aem/lesson/lesson1-1.jpg)
6、选中quote,右键创建文件quote.html
7、在quote.html中输入下面的内容，点击save all。

```html
<h3>My Quote Component</h3>

<blockquote>
	I am always doing that which I cannot do, in order that I may learn how to do it.
</blockquote>
<p>― Pablo Picasso</p>
```
***总结：***
> 此时创建的组件，还不具备在AEM的SITE中能被看到或可以选择到。但已经具备一个简单组件的基本特征。
{: .prompt-danger }

## 练习二：创建渲染结点，把练习一的组件进行显示html中的内容。
***步聚：***
1、在CRXDE lite中，到/content/wetrain/us/en。
2、新建结点名为helloworld, 类型为cp:Page的结点，点击save all。
![img](/assets/articles/aem/lesson/lesson2-1.jpg)
3、点击helloworld结点右键，再创建结点，名称为jcr:content,类型为cp:PageContent，点击save all。
![img](/assets/articles/aem/lesson/lesson2-2.jpg)
4、将jcr:content的结点和组件进行关联绑定。即添加属性后进行save all保存。

| 属性 | 类型 | 值 | 说明 |
|------|----|---|---|
| sling:resourceType | String | wetrain/components/quote | |

5、在浏览中进行访问：
http://localhost:4502/content/wetrain/us/en/helloworld.html
![img](/assets/articles/aem/lesson/lesson2-3.jpg)
结点下有多个资源时，匹配规则（Selector越多，匹配精度越高）：
![img](/assets/articles/aem/lesson/lesson2-4.jpg)


## 练习三：理解练习二中是如何通过渲染找到组件进行显示的。
***步聚:***
1、当用户访问http://localhost:4502/content/wetrain/us/en/helloworld.html时。
2、Sling框架，将提取域名部分http://localhost:4502和资源访问部分<font color='red'>/content/wetrain/us/en/helloworld.html</font>。
3、将资源部分去除扩展部分，然后在CRXDE中进行搜索匹配，此时找到：
/content/wetrain/us/en/helloworld，但helloworld是cq:Page，没有<font color='red'>sling:resourceType</font>属性，则找子结点，此时找到/content/wetrain/us/en/helloworld/jcr:content结点，此时找到了<font color='red'>sling:resourceType</font> 属性，取出值为：<font color='red'>wetrain/components/quote </font>

![img](/assets/articles/aem/lesson/lesson3-1.jpg)
4、将wetrain/components/quote 拼接成“/apps/wetrain/components/quote”,再进行匹配查找到组件。
![img](/assets/articles/aem/lesson/lesson3-2.jpg)
5、通过组件名，寻找组件名对应的html文件进行渲染。最终输出对应的html中的内容。

## 练习四：通过创作者界面的交互方式进行添加组件
***步聚:***
1、刷新http://localhost:4502/sites.html/content/wetrain/us/en，此时会看到一个helloworld的页面，选中然后点edit打开，此时看到开发的quote组件并不具备编辑和被选中的能力。
![img](/assets/articles/aem/lesson/lesson4-1.jpg)
2、在CRXDE中找到<font color='red'>/content/wetrain/us/en/helloworld/jcr:content</font>，然后修改jcr:conent中的<font color='red'>sling:resourceType</font>的属性值为<font color='red'>wetrain/components/page</font>。
同时添加cq:template属性，字符串类型，值为/conf/wetrain/settings/wcm/templates/page-content
![img](/assets/articles/aem/lesson/lesson4-2.jpg)
![img](/assets/articles/aem/lesson/lesson4-3.jpg)
3、点击save all。再次刷新：http://localhost:4502/editor.html/content/wetrain/us/en/helloworld.html
![img](/assets/articles/aem/lesson/lesson4-4.jpg)
看到第2步设置使用模板已经生效，并且使用该helloworld页面具备添加组件的能力。
4、查看是否可以找到Quote组件。
![img](/assets/articles/aem/lesson/lesson4-5.jpg)
5、为Quote组件添加属性对话框，只有添加对话框的情况下才能被找到。
从其它组件中找一个带cq:dialog的进行copy。然后贴到quote的结点下。点击save all。
![img](/assets/articles/aem/lesson/lesson4-6.jpg)![img](/assets/articles/aem/lesson/lesson4-7.jpg)
6、刷新http://localhost:4502/editor.html/content/wetrain/us/en/helloworld.html
然后添加一个组件，查义Quote，此时可以显示并拖放出来了。
![img](/assets/articles/aem/lesson/lesson4-8.jpg)

![img](/assets/articles/aem/lesson/lesson4-9.jpg)

## 练习五：占位符组件
***步聚：***
1、在/apps/<your-site>/components下创建一个placeholder，cq:Component的组件。
2、添加cq:dialog。
3、添加一个placeholder.html，内容如下：
```html
<!-- 方式一 -->
<!-- <div class="cmp-placeholder--container" data-emptytext="${properties.jcr:title}" data-sly-test="${(wcmmode.edit || wcmmode.preview)}"></div> -->

<!-- 方式二通过模板的方式 -->
<sly data-sly-use.template="core/wcm/components/commons/v1/templates.html"
     data-sly-call="${template.placeholder @ isEmpty=!model.text}">
</sly>
```
4、save all,测试在edit 或preview下的效果，还有在view in unpublish下的效果。

## 练习六：创建组件自定义的属性对话框。
***步聚:***
![img](/assets/articles/aem/lesson/lesson6-1.jpg)

1、在练习四中已经添加了cq:dialog。但现在需要改为满足我们自己组件的设计。
打开/apps/wetrain/components/quote/cq:dialog/content/items/column/items，删除所有子结点。
2、新建两个子结点。
myProperty(nt:unstructured)
| 属性 | 类型 | 值 | 说明 |
|-----|----|----|-----|
| fieldLabel | String | My Quote Property | 显示输入框的标签名称 |
| name | String | ./myQuote |用于存放myPoperty结点控件输入值，此为定义存放的key。必须加./ |
| fieldDescription | String | 可自定义 | 描述说明 |
| sling:resourceType | String | granite/ui/components/coral/foundation/form/textfield | 绑定GraintUI 的输入框控件 |

![img](/assets/articles/aem/lesson/lesson6-2.jpg)
使用同样的方法，再添加一个id属性，save all。
![img](/assets/articles/aem/lesson/lesson6-3.jpg)
3、刷新http://localhost:4502/editor.html/content/wetrain/us/en/helloworld.html
![img](/assets/articles/aem/lesson/lesson6-4.jpg)
4、在属性输入框，分别输入helloworld is good! ； pid12354433,点击done保存。
![img](/assets/articles/aem/lesson/lesson6-5.jpg)
此时组件还不能显示保存的值，因为html中还没有写代码读取。
5、查看输入的值存放的情况。
在CRXDE 中，找到使用quote组件的位置：/content/wetrain/us/en/helloworld/jcr:content/root/container/container/quote，然后查看结点的属性。
可以看到myQuote和id属性分别存储我们在dialog中输入的值了。
![img](/assets/articles/aem/lesson/lesson6-6.jpg)
6、读取值。
这里使用的是HTL的全局对象Properties的方式进行读取。
修改/apps/wetrain/components/quote/quote.html中的html内容如下：
```html
<h3>My Quote Component</h3>

<blockquote>
	<p>MyQuote:${properties.myQuote}</p>
    <p>ID:${properties.id}</p>
</blockquote>
<p>― Pablo Picasso</p>
```
再次刷新http://localhost:4502/editor.html/content/wetrain/us/en/helloworld.html
![img](/assets/articles/aem/lesson/lesson6-7.jpg)

## 练习七：自定义Selectors
***步聚：***
1、打开CRXDE，找到/apps/wetrain/components/quote
2、新建一个子文件blue.html
3、blue.html的内容如下：
```html
<!-- 设置内容显示为blue -->
<h3 style="color:blue">My Quote Component</h3>

<blockquote data-sly-test="${properties.myQuote}" style="color:blue">
	${properties.myQuote}
</blockquote>

<p style="color:blue">― Pablo Picasso</p>
```
4、通过selector的方式在浏览器中访问：http://localhost:4502/content/wetrain/us/en/helloworld.blue.html

![img](/assets/articles/aem/lesson/lesson7-1.jpg)
***总结***，至此一个简单并带属性修改的自定义组件开发完成了。需要做的就是同步CRXDE中的结点结构到代码当中。
使用前面装的AEM插件，右键进行同步即可。如IDEA：
![img](/assets/articles/aem/lesson/lesson7-2.jpg)

![img](/assets/articles/aem/lesson/lesson7-3.jpg)
最后执行 <font color='red'> mvn clean install -PautoInstallSinglePackage -DskipTests="true" </font>进行编译安装即可。

## 练习八：HTL全局属性的使用
***步聚：***
1、修改quote.html，把原来的内容删除，修改成如下：
```html
<h3>My Quote Component</h3>

<!--/* Tests to see if the author added a quote into the dialog */-->
<blockquote data-sly-test="${properties.myQuote}">
	${properties.myQuote}
</blockquote>
<p data-sly-test="${properties.myQuote}">― Pablo Picasso</p>

<h4>Global object docs and Javadoc</h4>
<blockquote>
    <ul>
    <li><a href="https://experienceleague.adobe.com/docs/experience-manager-htl/using/htl/global-objects.html">
        Available Global Objects in HTL</a></li>
	<li><a href="https://helpx.adobe.com/experience-manager/6-5/sites/developing/using/reference-materials/javadoc/overview-summary.html">
        Experience Manager 6.5 Javadocs</a></li>
    <li><a href="https://javadoc.io/doc/com.adobe.aem/aem-sdk-api/latest/index.html">
        Experience Manager Cloud Service Javadocs</a></li>
    </ul>
</blockquote>

<h3>Examples:</h3>
<h4>
	<a href="https://helpx.adobe.com/experience-manager/6-5/sites/developing/using/reference-materials/javadoc/org/apache/sling/api/SlingHttpServletRequest.html">Request Object API</a>
	(request)
</h4>
<blockquote>
	<p>request Path: ${request.resource.path}</p>
	<p>request resourceType: ${resource.resourceType}</p>
</blockquote>

<h4>  
	<a href="https://sling.apache.org/apidocs/sling7/org/apache/sling/api/resource/Resource.html">Resource Object API</a>
	(resource)
</h4>
<blockquote>
	<p>resource Path: ${resource.path}</p>
</blockquote>

<h4>
	<a href="https://sling.apache.org/apidocs/sling7/org/apache/sling/api/resource/ResourceResolver.html">ResourceResolver Object API</a>
	(resourceResolver)
</h4>
<blockquote>
	<p>resourceResolver Component Path: ${resourceResolver.findResource @ path=resource.resourceType}</p>
</blockquote>

<h4>
	<a href="https://helpx.adobe.com/experience-manager/6-5/sites/developing/using/reference-materials/javadoc/com/day/cq/wcm/api/Page.html">Page Object API</a>
	(currentPage)
</h4>
<blockquote>
	<p>currentPage Name: ${currentPage.Name}</p>
	<p>currentPage Title: ${currentPage.Title || "[jcr:title property not currently set]"}</p>
	<p>currentPage Parent: ${currentPage.parent.Title  || "[jcr:title property not currently set]"}</p>
	<p>currentPage Path: ${currentPage.Path}</p>
	<p>currentPage Depth: ${currentPage.Depth}</p>
</blockquote>
```
2、刷新Quote组件所在的页面。
![img](/assets/articles/aem/lesson/lesson8-1.jpg)

***总结：
请详细看html中的全局属性的使用如Request，Resource， ResourceResolver，CurrentPage等属性的使用。***

[文档连接](https://experienceleague.adobe.com/zh-hans/docs/experience-manager-htl/content/global-objects)


## 练习九：使用HTL属性的方式渲染内容
同样修改quote.html如下：<font color='red'>重点学习${}的使用</font>
```html
<blockquote>
    Learn more about these HTL attributes in the 
    <a href="https://github.com/Adobe-Marketing-Cloud/htl-spec/blob/master/SPECIFICATION.md">HTL specification</a> <br/>
</blockquote>
<h3>My Quote Component</h3>

<!--/* Tests to see if the author added a quote into the dialog */-->
<!--/* Save a value in a variable */-->
<!--/* Change HTML element type dynamically */-->
<div 
	data-sly-set.phrase="${properties.myQuote}"
	data-sly-element="blockquote"
	data-sly-test="${phrase}">
	${phrase}
</div>

<!--/* Reuse defined variables throughout the HTL */-->
<p data-sly-test="${phrase}">― Pablo Picasso</p>

<h3>My Quote Component with Default content</h3>

<!--/* Tests, if the author added a quote, otherwise provides a default */-->
<!--/* data-sly-text sets the element value */-->
<!--/* data-sly-attribute only is printed, if a attribute value exists */-->
<blockquote
    data-sly-text="${properties.myQuote ? properties.myQuote : 'No quote specified' }"
    data-sly-attribute.cite="${properties.cite}">
        Dummy text, which will be overwritten by data-sly-text
</blockquote>
 <!--/* Dummy text is not required when using data-sly-text */-->
<p data-sly-text="${quotee ? quotee : '- Who said this quote' }"></p>

<h4>Learn more about these HTL attributes in the 
    <a href="https://github.com/Adobe-Marketing-Cloud/htl-spec/blob/master/SPECIFICATION.md">HTL specification</a></h4>
<h3>The examples below use the path ${currentNode.path}</h3>
<h4>Ex 1: Properties of the ${currentNode.name} Component</h4>
    In this example we use the <b>properties</b> object and <b>data-sly-list</b> attribute to show ValueMap and it's values
    Learn more about the <a href="https://helpx.adobe.com/experience-manager/6-5/sites/developing/using/reference-materials/javadoc/org/apache/sling/api/resource/ValueMap.html">ValueMap API</a> used for the <b>properties</b> object
<ul data-sly-list=${properties}>
	<li>
      ${item}: ${properties[item]}
    </li>
</ul>
<h4>Ex 2: Sibling Nodes (other components) of the ${currentNode.name} node</h4>
    In this example we use the <b>currentNode</b> object and <b>data-sly-list</b> and <b>data-sly-test</b> attributes to view sibling nodes <br/>
    Learn more about the <a href="https://docs.adobe.com/docs/en/spec/jsr170/javadocs/jcr-2.0/javax/jcr/Node.html">Node API</a>
<ul data-sly-list=${currentNode.parent.nodes}>
	<li data-sly-test="${item.name != currentNode.name}">
      ${item.name}
    </li>
</ul>
<h4>Ex 3: Sibling resources (other components) of the ${resource.name} node</h4>
    This is the same as Ex 3 except we use the <b>resource</b> object instead <br/>
    Learn more about the <a href="https://sling.apache.org/apidocs/sling7/org/apache/sling/api/resource/Resource.html">Resource API</a>
<ul data-sly-list=${resource.parent.listChildren}>
	<li data-sly-test="${item.name != resource.name}">
      ${item.name}
    </li>
</ul>

<sly data-sly-use.rootSitePage="${currentPage.parent.parent.parent.path}" />
<h3>The examples below use ${rootSitePage.path}<br/></h3>
<h4>Ex 4: Child resources of ${rootSitePage.name}</h4>
	In this example we use <b>data-sly-list</b> attribute to view the child resources
<ul data-sly-list=${rootSitePage.listChildren}>
	<li >
      ${item.name}
    </li>
</ul>

<h4 data-sly-use.jcrContent="${rootSitePage.path}/jcr:content">Ex 5: Child Pages of ${jcrContent.jcr:title}</h4>
    In this example we use <b>data-sly-list, data-sly-test,</b> and <b>data-sly-use</b> attributes to
	get the page title from the jcr:title property under the jcr:content node of each valid page
<ul data-sly-list=${rootSitePage.listChildren}>
	<li data-sly-test="${item.resourceType.toString == 'cq:Page'}">
      <a data-sly-use.childJcrContent="${item.path}/jcr:content" 
      		href="${item.path @ extension='html'}">${childJcrContent.jcr:title}</a>
    </li>
</ul>
```

## 练习十：了解核心组件和代理组件
***步聚:***
1、***WCM核心组件***，由AEM提供，在6.5版本后安装在/libs/core/wcm/components下面并且有些组件可以有不同的版本如Text组件
![img](/assets/articles/aem/lesson/lesson10-1.jpg)![img](/assets/articles/aem/lesson/lesson10-2.jpg)
核心组件都包括那些内容？如Image组件举例说明。
版本控制如：v1,v2,v3
***clientlibs***：该图片组件的所需样式和必要的js逻辑控制。（css,less,js等）
***cq:design_dialog***:  设计组件对话框。通过page->Edit Template 的方式打时，在allowed Components中显示的组件旁边有个齿轮图标，这个图标打开的就通过cq:design_dialog弹出来，默认弹出来的只有policy

![img](/assets/articles/aem/lesson/lesson10-3.jpg)
***cq:dialog***:  组件的属性对话框。通过板手的图标打开的对话框。
![img](/assets/articles/aem/lesson/lesson10-4.jpg)
***cq:editConfig***: 组件拖放后显示的状态，可以通过配置的方式来显示默认拖放时的组件配置样式。
***布局：***
核心组件在出厂时就已经包括响应式网格布局，大大提升了在不同设备及不同大小的网格中进行排板。
如何设置网络模式。
选中Root Container,点“板手”符号进行修改
![img](/assets/articles/aem/lesson/lesson10-5.jpg)
在Layout中的下拉菜单中选择Responsive Grid后确认。
![img](/assets/articles/aem/lesson/lesson10-6.jpg)
然后点击图片或组件中的layout工具，即可进行拖动布局。
![img](/assets/articles/aem/lesson/lesson10-7.jpg)

***2、代理组件***
通常是在/apps下，如:/apps/<your-site>/components 
![img](/assets/articles/aem/lesson/lesson10-8.jpg)
使用代理组件时，除了自定义的外，所有AEM提供的组件都是通过sling:resourceSuperType进行绑定到核心组件中。如Image，可以看到最终用的是V3版本的核心组件<font color='red'>core/wcm/components/image/v3/image</font>
![img](/assets/articles/aem/lesson/lesson10-9.jpg)

## 练习十一：如何安装核心组件或升级核心组件
***步聚：***
1、[打开官方开源连接](https://github.com/adobe/aem-core-wcm-components/releases)
2、找到Latest release版本。
3、打开开发代码工程根目录找到pom.xml
4、打开pom.xml
找到core.wcm.components.version 改成最新稳定的版本。
SDK的API版本同样也可以升aem.sdk.api
```xml
...
<properties>
    <aem.host>localhost</aem.host>
    <aem.port>4502</aem.port>
    <aem.publish.host>localhost</aem.publish.host>
    <aem.publish.port>4503</aem.publish.port>
    <sling.user>admin</sling.user>
    <sling.password>admin</sling.password>
    <vault.user>admin</vault.user>
    <vault.password>admin</vault.password>
    <frontend-maven-plugin.version>1.12.0</frontend-maven-plugin.version>
    <core.wcm.components.version>2.28.0</core.wcm.components.version>
    <bnd.version>6.4.0</bnd.version>
    <project.build.sourceEncoding>UTF-8</project.build.sourceEncoding>
    <project.reporting.outputEncoding>UTF-8</project.reporting.outputEncoding>
    <aem.sdk.api>2025.8.22171.20250828T220440Z-250800</aem.sdk.api>
    <aemanalyser.version>1.6.6</aemanalyser.version>
    <componentGroupName>wetrain</componentGroupName>
  </properties>
...
```
5、修改完后执行 mvn clean install -PautoInstallSinglePackage 进行安装即可完成升级。

## 练习十二：组件的样式命名规则
自定义组件时，当需要对组件添加样式时，官方建议使用如下命名规则。
`cmp-<component name> -- <style name>[_ _ <element name>]`
如:
cmp-quote--container
cmp-quote--container_ _image

## 练习十三：client-side library 的了解及CSS/JS加载的顺序
结点结构，必须是：***cq:ClientLibraryFolder***类型
该结点通常可能包含有的属性：
***categories***: 分类
***dependencies***: 依赖
***embed***: 嵌入
***allowProxy***: 是否允许代理
***js.txt/css.txt***：js或css文件
![img](/assets/articles/aem/lesson/lesson13-1.jpg)
![img](/assets/articles/aem/lesson/lesson13-2.jpg)
![img](/assets/articles/aem/lesson/lesson13-3.jpg)
组件的clientlibs的寻找过程，当站点的页面加载时，先查询到该页面所用到的组件,然后查找该组件是否有定制clientlibs的样式或js库。如果没有，则寻找clientlib-dependencies，如果依赖中也没有指定，则再从clientlib-site中找，如果依然没有找到则最后从client-base中找，如果还没有定制，则此时的样式就不生效了。
![img](/assets/articles/aem/lesson/lesson13-4.jpg)
client-side library 库：在默认情况下cq:ClientLibraryFolder可以在/apps和/libs下的任何位置。当组件共用时可以写在：
Site-level(/apps/<your-project>/clientlibs): 站点级别的目录下
Component-level(/apps/<your-project>/clientlibs): 组件级别的的目录下。

***示例***：
将quote.html修改为：
```html
<h3>My Quote Component</h3>
<div class="cmp-quote--container">
	<div class="cmp-quote--property__title">${properties.myQuote}</div>
    <div class="cmp-quote--property__id">${properties.id}</div>
</div>
```
代码中添加cmp-quote--container，cmp-quote--property__title，cmp-quote--property__id 三个样式约束。在没有添加clientlibs的情况下，在浏览器http://localhost:4502/content/wetrain/us/en/helloworld.html
由于没有定义过这几个样式的值，所以此时看到的没有什么变化，即和无样式设置一样的效果。
![img](/assets/articles/aem/lesson/lesson13-5.jpg)
***下面增加样式***：
为了验证上面的寻找CSS的样式顺序，我把相关的寻找路径下设置好样式，再进行测试验证。
即分别在clientlib-base, clientlib-dependencies, clientlib-site下创建样式进行验证。

***clientlib-base***: (/apps/<your-site>/clientlibs-base) 
***步聚***：
1、在clientlib-base的节点下新建子文件夹结点basecss。
2、在basecss节点下创建qt.css,内容如下：
```css
.cmp-quote--container {
    display:flex;
    flex-direction: row;
    gap: 10px;
    background-color: #fff;
}
```
3、修改clientlib-base下的css.txt如下：
```txt
###############################################################################
# Copyright 2017 Adobe Systems Incorporated
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
###############################################################################

#引入对应的css文件
basecss/qt.css
```
![img](/assets/articles/aem/lesson/lesson13-6.jpg)
***clientlib-dependencies***
1、在clientlib-dependencies下创建一个quote文件夹。
2、在quote文件夹下创建一个dp_qt.css,并输入如下内容。
```css
.cmp-quote--container {
    display:flex;
    flex-direction: row;
    gap: 10px;
    background-color: #0066cc;
}
```
3、在clientlib-dependencies下的css.txt中加入：
#base=quote 的目的是指向quote文件夹.
```txt
#base=quote

dp_qt.css
```

***clientlib-site***
说明此下面的js,css基本上是通过编译ui.frontend前端使用webpack打包页来。
1、在clientlib-site下的css文件夹下创建一个site-qt.css，内容如下：
```css
.cmp-quote--container {
    display:flex;
    flex-direction: row;
    gap: 10px;
    background-color: #33ff00;
}
```
2、在css.txt中进行引用site-qt.css
```txt
#base=css

site.css
site-qt.css
```
***<Component Name>/clientlibs***
在自己的组件中定义：
注意点在于通过<font color='red'>categories</font>的方式来指定
步聚
1、选中自己的组件如Quote结点。新建名称为clientlibs，类型为 cq:ClientLibraryFolder的节点，点save all。
![img](/assets/articles/aem/lesson/lesson13-7.jpg)
2、针对clientlibs添加categories属性，类型为String[],名称为wetrain.quote,<font color='red'>添加时注意点选Multi按钮，否则创建的是String类型而不是String[]</font>
![img](/assets/articles/aem/lesson/lesson13-8.jpg)
3、在clientlibs下分别创建一个css.txt文件和一个qcss文件夹。
4、在qcss下创建一个quote.css,内容如下：
```css
.cmp-quote--container {
    display:flex;
    flex-direction: row;
    gap: 10px;
    background-color: #ffcc00;
}
```
5、修改css.txt
```txt
#base=qcss

quote.css
```
6、为了让组件下的样式生效，我们需要在quote.html添加<sly>节点来指定使用那个样式文件。
<sly data-sly-use.clientlib="/libs/granite/sightly/templates/clientlib.html" data-sly-call="${clientlib.all @ categories='wetrain.quote'}" />
其中clientlib.all是指将clientlibs下的所有css,js都加载，通过categories来指定加截的是那个组件的categories中的样式或js.
>注：如果没有指定，则只会从clientlib-site，clientlib-dependencies，clientlib-base中查找cmp-quote--container 指定的样式名。
{: .prompt-danger }
```html
<sly data-sly-use.clientlib="/libs/granite/sightly/templates/clientlib.html" data-sly-call="${clientlib.all @ categories='wetrain.quote'}" />
<h3>My Quote Component</h3>
<div class="cmp-quote--container">
	<div class="cmp-quote--property__title">${properties.myQuote}</div>
    <div class="cmp-quote--property__id">${properties.id}</div>
</div>
```
上面建好之后，可以进行测试，逐个将cmp-quote--container 改名，目的是伪造找不到名称时从何加载。
<Component Name>/clientlibs的效果：
![img](/assets/articles/aem/lesson/lesson13-9.jpg)
***clientlib-site***的效果：
![img](/assets/articles/aem/lesson/lesson13-10.jpg)
***clientlib-dependencies***的效果：
![img](/assets/articles/aem/lesson/lesson13-11.jpg)
***clientlib-base***的效果：
![img](/assets/articles/aem/lesson/lesson13-12.jpg)

寻找过程 `<Component Name>/clientlibs > clientlib-dependencies > clientlib-site > clientlib-base`

***总结：***
>当UI.frontend编译使用webpack打包的css和js文件都被打包到clientlib-site下了。所以正常情况下没有特殊的方式，组件中可以不专门开发自己的样式，那什么时候用？当在设计时需要切换组件的样式时可以考虑写到组件上，这样比较清楚，以免全部使用全局的属性，避免后属修改影响到其它人。
{: .prompt-warning }

## 练习十四：将UI.frontend中的样式编译及使用
***步聚***：
1、使用IDE打开工程代码，到ui.frontend/src/main/webpack/components下。
2、右键创建一个contentfragment文件夹，在文件夹下新建一个_contentfragment.scss,内容如下：
```css
 .contentfragment {
	h1, h2, h3 {
		padding: 5px;
		border-left: medium solid #000000;
	}
}
.contentfragment p {
	font-size: 15px;
	margin: 0 20px 10px;
}
```
3、打开AEM的站点交互的helloworld页，拖放一个Content Fragment（内容片段）
![img](/assets/articles/aem/lesson/lesson14-1.jpg)
4、点击数字资产(Asset), Category下选择Content Fragments进行过滤出内容片段。
![img](/assets/articles/aem/lesson/lesson14-2.jpg)
5、选择一个SurfCamp Costa Rica这个内容片段。
![img](/assets/articles/aem/lesson/lesson14-3.jpg)
![img](/assets/articles/aem/lesson/lesson14-4.jpg)
此时展示的并没有样式效果。
6、使用mvn clean install -PautoInstallSinglePackage 来安装前面在ui.frontend 中添加的_contentfragment.scss。
![img](/assets/articles/aem/lesson/lesson14-5.jpg)
7、刷新http://localhost:4502/editor.html/content/wetrain/us/en/helloworld.html
![img](/assets/articles/aem/lesson/lesson14-6.jpg)
可以看到样式已经变化了，说明我们在ui.frontend中添加的scss生效了。

## 练习十五：为页面添加样式，并通过组件系统样式的进行加载
在默认情况下，所有的AEM的组件，都会内置样式加载系统策略。此示例演示，如果添加一个样式，供Page页面进行在编辑页面时使用，本次添加的样多是让页面中的所有内容居中显示的示例。
步聚：
1、在ui.frontend/src/main/webpack/components下新建一个page文件夹。
2、在page文件夹下新建一个_page-center.scss,内容为：
```css
.wetrain-page--center {
	p, h1, h2 {
		text-align: center;
	}
}
```
3、使用mvn clean install -PautoInstallSinglePackage 来安装。
4、到AEM平台，点击General -> Templates -> WeTrain -> 点击修改 -> Page Information -> Page Policy
![img](/assets/articles/aem/lesson/lesson15-1.jpg)![img](/assets/articles/aem/lesson/lesson15-2.jpg)
![img](/assets/articles/aem/lesson/lesson15-3.jpg)
添加一个策略，然后在Properties中的Styles中，添加样式： Center Text : wetrain-page--center,然后保存。
5、刷新http://localhost:4502/editor.html/content/wetrain/us/en/helloworld.html，就可以看到有个样式笔的图标出现了。
![img](/assets/articles/aem/lesson/lesson15-4.jpg)
选中样式，观察内容的变化
![img](/assets/articles/aem/lesson/lesson15-5.jpg)


## 练习十六：使用其它站点的样式库
自己的项目WeTrain, 其它项目如:wknd
***步聚***：
1、查看wknd的clientlib-site中的categories的值。如：wknd.site
![img](/assets/articles/aem/lesson/lesson16-1.jpg)
2、AEM平台 Tools -> General -> Template -> WeTrain -> edit -> Page Infomation -> Page Policy 打开页面的策略,然后在Properties下的client Libraries下添加一个wknd.site, 之后done进行保存。
![img](/assets/articles/aem/lesson/lesson16-2.jpg)
3、刷新：http://localhost:4502/content/wetrain/us/en/helloworld.html?wcmmode=disabled
![img](/assets/articles/aem/lesson/lesson16-3.jpg)
查看元素，可以看到wknd.site的样式被集成进来了。